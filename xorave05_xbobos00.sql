DROP TABLE Lekaren CASCADE CONSTRAINTS;
DROP TABLE Vykaz CASCADE CONSTRAINTS;
DROP TABLE Nakup CASCADE CONSTRAINTS;
DROP TABLE Liek CASCADE CONSTRAINTS;
DROP TABLE Zdravotna_poistovna CASCADE CONSTRAINTS;
DROP TABLE Sklad CASCADE CONSTRAINTS;

create table LEKAREN
(
    ID_LEKARNE      int GENERATED BY DEFAULT AS IDENTITY (START WITH 1 INCREMENT BY 1) not null,
    ULICA           VARCHAR(20) not null,
    SUPISNE_CISLO   NUMBER(5) not null,
    ORIENTACNE_CISLO NUMBER(3),
    PSC             NUMBER(5) not null,
    MESTO           VARCHAR(20) not null,
    TELEFONNE_CISLO CHAR(13),
    DATUM_INVENTURY DATE,
    SKLAD_ID        int,

    CHECK (REGEXP_LIKE(TELEFONNE_CISLO, '^\+421\d{9}$') ),
    CONSTRAINT SKLAD_LEKARNE
        FOREIGN KEY (SKLAD_ID)
            REFERENCES SKLAD(ID_SKLADU)
                ON DELETE CASCADE
);

create table JE_V_ZMLUVE
(
    POISTOVNA_ID    int not null,
    LEKAREN_ID      int,

    CONSTRAINT VZTAH_LEKAREN
        FOREIGN KEY (LEKAREN_ID)
            REFERENCES LEKAREN(ID_LEKARNE)
                ON DELETE CASCADE,

    CONSTRAINT VZTAH_POISTOVNA
        FOREIGN KEY (POISTOVNA_ID)
            REFERENCES ZDRAVOTNA_POISTOVNA (ID_POISTOVNE)
                ON DELETE CASCADE
);

create table VYKAZ
(
    ID_VYKAZU           int GENERATED BY DEFAULT AS IDENTITY (START WITH 1 INCREMENT BY 1) not null,
    DATUM_VYHOTOVENIA   DATE,
    POISTOVNA_ID        int,

    CONSTRAINT VYDAVA_POISTOVNI
        FOREIGN KEY (POISTOVNA_ID)
            REFERENCES ZDRAVOTNA_POISTOVNA (ID_POISTOVNE)
                ON DELETE CASCADE
);

create table AKTUALIZUJE
(
    ID_VYKAZ            int not null,
    ID_NAKUP            int not null,
    LIEKY_NA_PREDPIS    int not null,
    FOREIGN KEY (ID_VYKAZ) REFERENCES VYKAZ(ID_VYKAZU),
    FOREIGN KEY (ID_NAKUP) REFERENCES NAKUP(CISLO_POKLADNICNEHO_BLOKU)
);

create table NAKUP
(
    CISLO_POKLADNICNEHO_BLOKU int GENERATED BY DEFAULT AS IDENTITY (START WITH 1 INCREMENT BY 1) not null,
    DATUM_PREDAJA             DATE,
   -- ZAKUPENY_TOVAR            VARCHAR(30),
    LEKAREN                   int,

    CONSTRAINT ZAKUEPNY_V
        FOREIGN KEY (LEKAREN)
            REFERENCES LEKAREN(ID_LEKARNE)

);

create table SUCAST_NAKUPU
(
    NAKUP_ID    int not null,
    LIEK_ID     int not null,

    CONSTRAINT NAKUP
        FOREIGN KEY (NAKUP_ID)
            REFERENCES NAKUP(CISLO_POKLADNICNEHO_BLOKU)
                ON DELETE CASCADE,

    CONSTRAINT LIEKY
        FOREIGN KEY (LIEK_ID)
            REFERENCES LIEK(NAZOV_LIEKU)
                ON DELETE CASCADE
);

create table LIEK
(
    NAZOV_LIEKU      VARCHAR(50) not null,
    CENA             DECIMAL(5, 2),
    DENNA_DAVKA      VARCHAR(70),
    UCINNA_LATKA     VARCHAR(150),
    EXPIRACIA        DATE,
    VEDLAJSIE_UCINKY VARCHAR(150)
);

CREATE TABLE NA_PREDPIS
(
    NAZOV_LIEKU VARCHAR(50) not null,

    CONSTRAINT PK_NA_PREDPIS PRIMARY KEY (NAZOV_LIEKU),
    CONSTRAINT FK_NA_PREDPIS FOREIGN KEY (NAZOV_LIEKU)
        REFERENCES LIEK (NAZOV_LIEKU)
);

CREATE TABLE  BEZ_PREDPISU
(
    NAZOV_LIEKU VARCHAR(50) not null,

    CONSTRAINT PK_BEZ_PREDPISU PRIMARY KEY (NAZOV_LIEKU),
    CONSTRAINT FK_BEZ_PREDPISU FOREIGN KEY (NAZOV_LIEKU)
        REFERENCES LIEK (NAZOV_LIEKU)
);

create table HRADI_DOPLATOK
(
    ID_LIEK         VARCHAR(50) not null,
    POISTOVNA       int not null,
    VYSKA_DOPLATKU  DECIMAL(5, 2),
    FOREIGN KEY (ID_LIEK) REFERENCES LIEK(NAZOV_LIEKU),
    FOREIGN KEY (POISTOVNA) REFERENCES ZDRAVOTNA_POISTOVNA(ID_POISTOVNE)
);

create table POCET_LIEKOV_NA_SKLADE
(
    ID_LIEK         VARCHAR(50) not null,
    ID_SKLAD        int not null ,
    POCET_LIEKOV    NUMBER(4),

    CONSTRAINT SKLAD_POCET
        FOREIGN KEY (ID_SKLAD)
            REFERENCES SKLAD(ID_SKLADU)
                ON DELETE CASCADE,

    CONSTRAINT LIEK_POCET
        FOREIGN KEY (ID_LIEK)
            REFERENCES LIEK(NAZOV_LIEKU)
                ON DELETE CASCADE
);

create table ZDRAVOTNA_POISTOVNA
(
    ID_POISTOVNE int GENERATED BY DEFAULT AS IDENTITY (START WITH 1 INCREMENT BY 1) not null,
    PLATNOST_ZMLUVY DATE
);

create table SKLAD
(
    ID_SKLADU int GENERATED BY DEFAULT AS IDENTITY (START WITH 1 INCREMENT BY 1) not null,
    MNOZSTVO_TOVARU_NA_SKLADE NUMBER,
    KAPACITA                  NUMBER,
    CHECK (MNOZSTVO_TOVARU_NA_SKLADE <= KAPACITA)
);

ALTER TABLE LEKAREN ADD CONSTRAINT pk_lekaren PRIMARY KEY(ID_LEKARNE);
ALTER TABLE VYKAZ ADD CONSTRAINT pk_vykaz PRIMARY KEY(ID_VYKAZU);
ALTER TABLE NAKUP ADD CONSTRAINT pk_nakup PRIMARY KEY(CISLO_POKLADNICNEHO_BLOKU);
ALTER TABLE LIEK ADD CONSTRAINT pk_liek PRIMARY KEY(NAZOV_LIEKU);
ALTER TABLE ZDRAVOTNA_POISTOVNA ADD CONSTRAINT pk_poistovna PRIMARY KEY(ID_POISTOVNE);
ALTER TABLE SKLAD ADD CONSTRAINT pk_sklad PRIMARY KEY(ID_SKLADU);

INSERT INTO LEKAREN(ULICA, SUPISNE_CISLO, ORIENTACNE_CISLO, PSC, MESTO, TELEFONNE_CISLO, DATUM_INVENTURY) VALUES('Antona Bernoláka', 2135, 2, 01001, 'Žilina','+421901961271',TO_DATE('01.03.2020', 'dd.mm.yyyy'));
INSERT INTO LEKAREN(ULICA, SUPISNE_CISLO, PSC, MESTO, TELEFONNE_CISLO, DATUM_INVENTURY) VALUES('Legionárska', 19, 91101, 'Trenčín','+421901961504',TO_DATE('10.03.2020', 'dd.mm.yyyy'));
INSERT INTO LEKAREN(ULICA, SUPISNE_CISLO, ORIENTACNE_CISLO, PSC, MESTO, TELEFONNE_CISLO, DATUM_INVENTURY) VALUES('Betliarska', 3776, 17,85107,'Bratislava','+421901961312',TO_DATE('08.03.2020', 'dd.mm.yyyy'));

INSERT INTO VYKAZ(DATUM_VYHOTOVENIA) VALUES(TO_DATE('11.03.2020', 'dd.mm.yyyy'));
INSERT INTO VYKAZ(DATUM_VYHOTOVENIA) VALUES(TO_DATE('11.03.2020', 'dd.mm.yyyy'));
INSERT INTO VYKAZ(DATUM_VYHOTOVENIA) VALUES(TO_DATE('12.03.2020', 'dd.mm.yyyy'));

INSERT INTO NAKUP(DATUM_PREDAJA) VALUES(TO_DATE('08.03.2020', 'dd.mm.yyyy'));
INSERT INTO NAKUP(DATUM_PREDAJA) VALUES(TO_DATE('10.02.2020', 'dd.mm.yyyy'));
INSERT INTO NAKUP(DATUM_PREDAJA) VALUES(TO_DATE('12.12.2019', 'dd.mm.yyyy'));

INSERT INTO SUCAST_NAKUPU(NAKUP_ID, LIEK_ID) VALUES(1,'CURAPROX CS 5460 ultrasoft');
INSERT INTO SUCAST_NAKUPU(NAKUP_ID, LIEK_ID) VALUES(2,'Dr.Max Magnesium B6 250 mg');
INSERT INTO SUCAST_NAKUPU(NAKUP_ID, LIEK_ID) VALUES(3,'Condrosulf 400 mg');

INSERT INTO LIEK(NAZOV_LIEKU, CENA, DENNA_DAVKA, UCINNA_LATKA, EXPIRACIA, VEDLAJSIE_UCINKY) VALUES ('Dr.Max Magnesium B6 250 mg','2,99','1 šumivá tableta denne','horčík a vitamín B6',TO_DATE('20.03.2021','dd.mm.yyyy'),'laxatívne účinky');
INSERT INTO LIEK(NAZOV_LIEKU, CENA, DENNA_DAVKA, UCINNA_LATKA, EXPIRACIA, VEDLAJSIE_UCINKY) VALUES ('Wobenzym','99,89','3-krát 5 až 3-krát 10 tabliet denne','pankreatín, amyláza, lipáza, bromelaín, trypsín, papaín, chymotrypsín, rutozid trihydrát',TO_DATE('03.08.2021','dd.mm.yyyy'),'nevýrazná zmena konzistencie, farby a zápachu stolice, pocit plnosti');
INSERT INTO LIEK(NAZOV_LIEKU, CENA, DENNA_DAVKA, UCINNA_LATKA, EXPIRACIA, VEDLAJSIE_UCINKY) VALUES ('Orinox 1 mg/ml','3,69','1 vstrek do každej nosovej dierky maximálne 3x denne','xylometazolíniumchlorid',TO_DATE('09.12.2020','dd.mm.yyyy'),'bolesti hlavy,nevoľnosť,krvácanie z nosa,zvýšený krvný tlak');

INSERT INTO ZDRAVOTNA_POISTOVNA(PLATNOST_ZMLUVY) VALUES(TO_DATE('30.06.2025', 'dd.mm.yyyy'));
INSERT INTO ZDRAVOTNA_POISTOVNA(PLATNOST_ZMLUVY) VALUES(TO_DATE('31.12.2027', 'dd.mm.yyyy'));
INSERT INTO ZDRAVOTNA_POISTOVNA(PLATNOST_ZMLUVY) VALUES(TO_DATE('31.08.2024', 'dd.mm.yyyy'));

INSERT INTO HRADI_DOPLATOK(ID_LIEK,VYSKA_DOPLATKU, POISTOVNA) VALUES('Wobenzym',10.06,1);
INSERT INTO HRADI_DOPLATOK(ID_LIEK,VYSKA_DOPLATKU, POISTOVNA) VALUES('Dr.Max Magnesium B6 250 mg',0.53,1);
INSERT INTO HRADI_DOPLATOK(ID_LIEK,VYSKA_DOPLATKU, POISTOVNA) VALUES('Orinox 1 mg/ml', 1.22,1);


INSERT INTO SKLAD(MNOZSTVO_TOVARU_NA_SKLADE, KAPACITA) VALUES('57','2250');
INSERT INTO SKLAD(MNOZSTVO_TOVARU_NA_SKLADE, KAPACITA) VALUES('380','2250');
INSERT INTO SKLAD(MNOZSTVO_TOVARU_NA_SKLADE, KAPACITA) VALUES('2250','2250');

COMMIT;

SELECT * FROM LEKAREN;
SELECT * FROM VYKAZ;
SELECT * FROM NAKUP;
SELECT * FROM LIEK;
SELECT * FROM ZDRAVOTNA_POISTOVNA;
